### 平均内存访问时间 MAT（Mean Access Time）
CPU 从存储系统中获取一个字的平均耗时
**命中（Hit）**：请求的数据在当前级别被找到
**未命中（Miss）**：请求的数据不在此级，需要向更慢的下一级继续寻找
设 $c$ 为 cache 访问时间，$h$ 为 cache 命中率，$m$ 为主存访问时间，则一层 cache 的 MAT 为
$$
MAT = c + (1-h) \times m
$$
#### 例题：
求下列 $3$ 级 cache 的 $MAT$：
$Lvl 1: 4ns$
$Lvl 2: 12ns$
$Lvl 3: 20ns$
MM（主存）:  $200 ns$

共计 $300$ 次请求，
$200$ 次于 $lvl 1$ 命中；
$50$ 次于 $lvl 2$ 命中；
$35$ 次于$ lvl 3$ 命中；
剩余的在 $MM$ 命中。
**解：**
共耗时 
$$
300 \times 4ns + (300-200) \times 12ns + (300-200-50) \times 20ns + (300-200-50-35) \times 200ns = 6400
$$
$$
MAT = \frac{6400}{300} = 21.333ns/请求
$$
### 机械硬盘HDD（Har-Disk Drives）
#### 逻辑结构
**柱面（Cylinder）：** 多个盘片垂直对齐的同心圆组成的柱面。
**磁道（Track）：** 每个盘面上的圆形轨道。
**扇区 （Sector）：** 磁盘上最小的数据单位，通常是 $512 byte$ 或 $4 KB$。
- 数据访问顺序通常是按 $柱面\rightarrow 磁道 \rightarrow 扇区$
#### 延迟时间
**寻道时间（Seek Time）：** 磁头移动到正确柱面所需的时间
- 最小寻道时间：移动到相邻柱面
- 最大寻道时间：移动到最远柱面（最外层到最内层）
- 平均寻到时间：$\frac{最大+最小}{2}$
**旋转延迟（Rotational Latency）：** 等待磁盘旋转到正确扇区的时间
- 若转速为 $n \space RPM$，则每转一圈时间 $t$ 为
$$
t = \frac{60}{n}
$$
- 平均旋转延迟为 $\frac{t}{2}$
总访问时间约等于寻道时间+旋转延迟
#### 例题：
一个硬盘有 **4000 个柱面**，每个柱面有 **5 个轨道（track）**，每个轨道有 **128 个扇区（sector）**。  
读取顺序是：先读完所有柱面的 track 0，再读所有柱面的 track 1，再是 track 2，依此类推。
已知磁盘转速为 **7200 RPM**，从相邻柱面间移动需要 **2ms**，最坏情况为 **18ms**；在同一个柱面内切换磁道的时间为 **3ms**。
求顺序访问总时间。
**解：**
每个柱面有 5 个磁道，说明该磁盘有 5 个单面的盘片或 3 个双面的盘片。
旋转速度 $7200 RPM$，旋转延迟为 $\frac{60}{7200} ≈ 0.00833333s = 8.33333ms$，平均旋转延迟为 $\frac{t}{2} = 4.1667ms$
1. 将读写头移至 track 0：最坏情况 18ms
2. **等待 sector 0：4.166666ms**（即半圈时间）
3. 读取第一个磁盘上的整个磁道：8.3ms
	- 切换到第二个磁盘磁道：3ms
	- 等待 sector 0：8.3ms - 3ms = **5.3ms**
	- 读取磁道：8.3ms
    重复以上步骤直到第五个磁道。
4. **切回第一个磁道：3ms**
	- 移动到下一个柱面：2ms
	- 等待 sector 0：8.3 - 3 - 2 = **3.3ms**
5. 对上述 3–4 步骤重复 **4000 次**（即柱面总数）
总时间 =  
18 ms（初始寻道） +  
4.17 ms（初始旋转延迟） +  
4000 * 5 * (8.3 + 3 + 5.3)  

有一块硬盘，共有**4000个柱面**，每个柱面包含**7个磁道**，每个磁道有**256个扇区**。要求依次读取每个磁道的所有扇区，从磁道0开始、从扇区0开始，依次类推。硬盘的转速为**1200 RPM**，相邻柱面之间寻道时间为**4 ms**，最坏情况下寻道时间为**40 ms**；同一柱面不同磁道之间切换需耗时**13 m**s。
50 ms 25 ms
1. 将读写头移至 track 0：最坏情况 40 ms
2. **等待 sector 0：25 ms**（即半圈时间）
3. 读取第一个磁盘上的整个磁道：50 ms
	- 切换到第二个磁盘磁道：13 ms
	- 等待 sector 0：50 ms - 13 ms = 37 ms**
	- 读取磁道：50 ms
    重复以上步骤直到第 7 个磁道。
4. **切回第一个磁道：13 ms**
	- 移动到下一个柱面：4 ms
	- 等待 sector 0：50 - 13 - 4 = **33 ms**
5. 对上述 3–4 步骤重复 **4000 次**（即柱面总数）
总时间 =  
40 ms（初始寻道） +  
25 ms（初始旋转延迟） +  
4000 * 7 * (50 + 13 + 37)  
